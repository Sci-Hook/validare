import * as chalk from 'chalk';
import { readFileSync } from 'fs';
import 'syncforeachloop';

export async function loadFiles(name,rule_file:string|string[]) {

    global[name] = {};

    var files:string[] = [];

    if (typeof rule_file == 'string') {
        files.push(rule_file);
    }else{
        files = rule_file;
    }

    files.syncForEach(function file(file,next_file) {
        try {
            
            var config:Buffer = readFileSync(process.cwd() + '/' +  file);
            try {
                var parsed = JSON.parse(config.toString('utf-8'));
                global[name] = Object.assign(global[name],parsed);
            } catch (error) {
                console.log(chalk.red(`[file-loader] File is not valid json. File: ${chalk.yellow(file)}`));
            }
        } catch (error) {
            console.log(chalk.red(`[file-loader] File can not read. File: ${chalk.yellow(file)}`));
        }
        next_file();
    });

}